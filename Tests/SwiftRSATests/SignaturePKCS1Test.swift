//
//  SignaturePKCS1Test.swift
//  SwiftRSATests
//
//  Created by Leif Ibsen on 10/02/2022.
//

import XCTest
@testable import SwiftRSA
import BigInt

// Test vectors from Wycheproof - file rsa_sig_gen_misc_test.json
class SignaturePKCS1Test: XCTestCase {

    struct testStruct {
        let msg: String
        let sig: String
        let mda: RSA.MessageDigestAlgorithm
        let ok: Bool
        
        init(msg: String, sig: String, mda: RSA.MessageDigestAlgorithm, ok: Bool = true) {
            self.msg = msg
            self.sig = sig
            self.mda = mda
            self.ok = ok
        }
    }

    let privPem1024 =
"""
-----BEGIN RSA PRIVATE KEY-----
MIICXQIBAAKBgQDQlB5jqYD6kvsl7Ux7Mwf4JwIwNK5/GnSR8Gmcp2ByheYq2OmU
usIbi24wXjNPSHQGfSjjBCMNyn8OhffOWVdwtuBUyfhEuobAaW7roHadjUo0fo/o
XHJKwcRJlK8Yo55xn3IfG8UMRqOebAdfzRZJ8B8iYIzn3GlVUCJYM2mH2QIDAQAB
AoGAX/SkfmkOozhXPj2LP+pcMjeP9CloVaUQF8uoap896bHcD742x2ubvRxKFwpf
RIwqhImz86yFi+Sqyz2qoU3MwYNiLu3Trm8EJ6KimLUbl4GKVDDxNwX0LYslR2+T
nJNeOJ4w2a3l0BgJIBNfWu8MX+zRXwC4O1HauLqTDYiCaAECQQDogtEtXwviaoA1
nxPAghC9y/dZ3+5pUxPvqIhpGWWbBk48ZWomevYnXtGviaXf6eJbMaArr71ZRFt1
B6IpiaaBAkEA5aZc+maL2FfVkTWnjBjIrbfCIjaOnXSrrY6DKZ96w8KteqRN2wXe
6m2bINuvCahhUoShfHLTcjJAM0aF6n4lWQJBAKMnyOjxnUFQQo9eBVo86sqEahnj
DUVTStYNiUtWyvmxvwyajZZbCogt/S4UhRVO5cvgUujU9SXC1fqVVLGZKgECQQCR
8XzrQRokfgVih/eXh/SYucwtFADkPc4QuR3P6OMK34CCDULRK1T0JH3Oju4ZNCHN
YC6EOTD5RMgaDfpzAIHZAkB1kVpFR3C0kIJCN2EkTM7GWm5IrplmNEtnVhD6ytkW
L6W9HMUQjDIsL7PBRPgHdzosfQl/Y+XI072M6O+sKt4E
-----END RSA PRIVATE KEY-----",
"""

    let pubPem1024 =
"""
-----BEGIN PUBLIC KEY-----
MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDQlB5jqYD6kvsl7Ux7Mwf4JwIw
NK5/GnSR8Gmcp2ByheYq2OmUusIbi24wXjNPSHQGfSjjBCMNyn8OhffOWVdwtuBU
yfhEuobAaW7roHadjUo0fo/oXHJKwcRJlK8Yo55xn3IfG8UMRqOebAdfzRZJ8B8i
YIzn3GlVUCJYM2mH2QIDAQAB
-----END PUBLIC KEY-----
"""
    
    let tests1024: [testStruct] = [
        testStruct(
            msg: "",
            sig: "03e64d148e05201b021fb5d3d72ab6abd4294be6c1673277ba5822ad2fe7ce4bb29ac547b2fdf09c2894ea0e31e76f1b3e1937db91c389467e9a8ac7be0a4f674456f01c5b4fa4277a26028b49b16e25689827d0a4b9f1c25a63350dc15131da908a05c7cfa8c08a67ac9efe3b0cd04aba7db12064cbc36729eaaec540c4bc12",
            mda: .SHA1),
        testStruct(
            msg: "0000000000000000000000000000000000000000",
            sig: "1d19763e80121e228ac4dbb3be8448560aac613ec74b168efe1d8a8335b77e6d8c3cc0f641de8c8e26a2aff9d32a4ab77340912fec0e60e89257b5b6b19c8deb866c2d2349fe63a06ac6b72397b478cdd4198ead64f8d36b9df29651e95ac7b886978cffbb5f7498f136b1ded7580cbcbb31620415eb71cdb5bd615b47eff813",
            mda: .SHA1),
        testStruct(
            msg: "54657374",
            sig: "0891ef2061c4d3377744cd7243ccc444619df533f4eadee216f7ffb9244e86d3e0162fc82c0b9502dc7aeebaf7884067e5f18f21b395c43bbfce5559ae84157ffde2aa457b7f44675e706af443acd9e38070428dfc6471a24cdc0d44f9283ac158704ad114375f10c24e3adbd12c55dabb78b8c41d3938124acc74126c82bb0b",
            mda: .SHA1),
        testStruct(
            msg: "313233343030",
            sig: "8277e8984d536f81667feeee7e24068ca5bb8b815210b3e9fa82294e11cae92c45164c9dd5683be4650e4b7709eb8879f793ae804620750b26032894e53333158f6afa6b52318e6c730a4a55d5a0fca6d029744f2ecaa2e00d3d6dffa0716acefd5c91afeda74b7f1a1bd7e635283bfa2142ace513da24eb8f25f3578a401ba7",
            mda: .SHA1),
        testStruct(
            msg: "61",
            sig: "29f69d320ea3221cd0704300f456295becf54e877c2b9b2704dc47ef992588c7dcc1648d17172d8c76362c488aadb3437be488fe667a192c5db1440f70d102361d7e85ffab370c7bdaceba0d15b1f32ba0801ccddc9fbaed1323834a60d19ff13ecd46a27f06e79cb0d3aefdefc0c69d8e85fbe8761d83f35e362355ba675933",
            mda: .SHA1),
        testStruct(
            msg: "e0e1e2e3e4e5e6e7e8e9eaebecedeeeff0f1f2f3f4f5f6f7f8f9fafbfcfdfeff",
            sig: "9aa3040e7df724bf506881f6a92a133ff76f6a168f0f3ced70b3363835ed6b655fae6f39416555af4071c16262da7556412d9905279d666f9e15fb8a813b313d00007cef3ed2be306b9e29e6b69c2c5bebe36aa057feba44ccb6c8619076a5b23f39729ef78bd6478249f34ee99f3abeef37c504410910d1ad3f1a712c8d697e",
            mda: .SHA1),
        testStruct(
            msg: "0102030405060708090a0b0c0d0e0f101112131415161718191a1b1c1d1e1f202122232425262728292a2b2c2d2e2f303132333435363738393a3b3c3d3e3f404142434445464748494a4b4c4d4e4f505152535455565758595a5b5c5d5e5f606162636465666768696a6b6c6d6e6f707172737475767778797a7b7c7d7e7f808182838485868788898a8b8c8d8e8f909192939495969798999a9b9c9d9e9fa0a1a2a3a4a5a6a7a8a9aaabacadaeafb0b1b2b3b4b5b6b7b8b9babbbcbdbebfc0c1c2c3c4c5c6c7c8c9cacbcccdcecfd0d1d2d3d4d5d6d7d8d9dadbdcdddedfe0e1e2e3e4e5e6e7e8e9eaebecedeeeff0f1f2f3f4f5f6f7f8f9fafbfcfdfeff000102030405060708090a0b0c0d0e0f1011121314151617",
            sig: "1fd0610221104c3f1e7f49d4c77c48bc169e630d5471e41100ba58dbf0ee0d4731a3d5b3c8cf9b07ad116e6cf65787650fb90bc85a9c4fe9940f4754316772c4946022178a3becbaa3d9b6252ed1353f7de834e0ac6d95d5a1f81453e89650f5690dc078df80dfe8ab614ca4881e7b001f9a11a4464b1004bb537f2b99624deb",
            mda: .SHA1),
        ]

    func test1024() throws {
        let pubKey = try RSAPublicKey(pem: pubPem1024, format: .PKCS8)
        let privKey = try RSAPrivateKey(pem: privPem1024, format: .X509)
        for t in tests1024 {
            let msg = Utilities.hex2bytes(t.msg)
            let sig = Utilities.hex2bytes(t.sig)
            XCTAssertEqual(t.ok, pubKey.verifyPKCS1(signature: sig, message: msg, mda: t.mda))
            if t.ok {
                let sig1 = try privKey.signPKCS1(message: msg, mda: t.mda)
                XCTAssertEqual(sig, sig1)
            }
        }
    }

    let privPem2048 =
"""
-----BEGIN RSA PRIVATE KEY-----
MIIEowIBAAKCAQEAorRRoH0KpfluRVZxUTVQUUqKW0YuvvcXCU+h/ugiJOY3+XRt
P3yv0xh42AMltu9aFwD2WQO0aUKeidbqyIRQl7WrOTGJ25JRLtincRoSU/rNIPec
Fegkfz0+QuRuSMmOJUov6XZTE6A+/48X4aApOXofomqNzib0kO2BKZYV2YFMItph
BCjgnH2WWFlCZvXAIdD87KCNlFoSvoLeTR7Oa0wDFFtdNJXU7VQR64eNrwX9evw+
Ca2g8RJkIvWQl1oZaYFvSGmLy7obTZyuedRg2Pn4Xnl1AF2bwixOWsD3waRdElaa
YoB9O5oC5aUw53MGb0U9H1tMLpz3ggKD90K51QIDAQABAoIBAHYn7vNWeyonJo5S
BT7NMcOnFyzLndzugZswals8ZrdXPKT6iO/G88SgC/oK5xOfZFQ6Taw9BYI/b/R3
z87IT+KsemixcgSzkCMuEQMQxOiZxOfBCWfbSs3gQtu/GdvgC0tHQd4QIKqq/7UF
THl8nxNvfZOsP8jK/2ZUJC14IevuUXv1N/RDZqD91FrgW5kJwubMHtkoHv9Dmfds
lrliM+wprgu/DXUrI0/BlzifUQUKoazQHAdMOsj7256otlGpWZXo20rVxDtshnPl
oSbn7pS43/TFr8ASWbyNp2lQuub4uucV9QmFsNb2bQTG/vO3AHIO7NzfFxu3sey+
conEZ8ECgYEA3EMQUPeC6JT7UkgkfZjLfVi40eJPO1XQQcVuTeCGsNW7AovaQu61
0jTVaB5YCdQV5qKJrUz794+Xj2w1gU9Q7r/xxbgKafeI6B5rq13ap4Np1lnRQ+xv
F+eYE6V1z62cVpFWuQET4ukRCtnntIock0im5lMyEZEpDqNs+zpbGPECgYEAvRqB
55d/mJgSInOuMiK1mOpfsZ606rw4MIpeMhlmA7LlAP+3n1uIaBZhHevEcvrEVUQH
C+sFfJQTeKaGivO3oD0/mIDsR9XgiblPveVCq6mujXLFcIjXq/WxMfOQmPe8Fg+Q
U2q8lJL9Tgbz7XKZ1Ll7sDZ3IH2VZp8UDPvCDyUCgYEAqUtSiyjykVmRIdkZUv/R
x/IdfBR52Z1HiIX7Fhhw7hIYvwhHJhLb5Ul+jZxlBojgnHhpYa4+LDVNxIrjRRR1
nEwjxFiEiJYdwGtBTmHA4ef7vSkj0xUy/iifltoiBxHljBQBmAjgBBQnaTO7B+Tv
ubSps3ZWkXIFIJ8z8JUV18ECgYA68OcqkzrvCf8lA994uv7VMcAv8aK8Q3xUDNy9
StNUNc9RF2NZZUNIBimxFMp/eA/376MuoMtuAA1tnqHy73H9nPmUhCKhZVV+N+dV
7f5w2QuSBQLrR4vJimP3iM46D4Vtbt5yUaODv6j6SAqBqSWvezzFOMS6uMn3WX/7
aAEdjQKBgCZA+/vP77Fj7nqHtkg6Zu5B+VbZD6ink5v8BC7gkksbeZPQRF91jVGT
PoUXnAMgsMlotIqRw4tb6SPhCXwMVi+I1CKUtqJ1m6+lQop08ScIdORfb8xg8hYC
3l7M0UPPMSQfWSG1rTmD+1TvF747KFNn5QyZnGcke1Uv5L/OlF97
-----END RSA PRIVATE KEY-----
"""

    let pubPem2048 =
"""
-----BEGIN PUBLIC KEY-----
MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAorRRoH0KpfluRVZxUTVQ
UUqKW0YuvvcXCU+h/ugiJOY3+XRtP3yv0xh42AMltu9aFwD2WQO0aUKeidbqyIRQ
l7WrOTGJ25JRLtincRoSU/rNIPecFegkfz0+QuRuSMmOJUov6XZTE6A+/48X4aAp
OXofomqNzib0kO2BKZYV2YFMItphBCjgnH2WWFlCZvXAIdD87KCNlFoSvoLeTR7O
a0wDFFtdNJXU7VQR64eNrwX9evw+Ca2g8RJkIvWQl1oZaYFvSGmLy7obTZyuedRg
2Pn4Xnl1AF2bwixOWsD3waRdElaaYoB9O5oC5aUw53MGb0U9H1tMLpz3ggKD90K5
1QIDAQAB
-----END PUBLIC KEY-----
"""

    let tests2048: [testStruct] = [
        testStruct(
            msg: "",
            sig: "840f5dac53106dd1f9c57219224cf51289290c42f20466875ba8e830ac5690e541536fcc8ab03b731f82bf66d83f194e7e180b3963ec7a2f3f7904a7ce49aed47da4d4b79421eaf937d301b3e696169297b797c32c076a12be4de0b58e003c5123051a84a10c62f8dac2f42a8640008eb3c7cccd6760ff5b51b689763922582845f048fb8150e5a7a6ca2eccc7bdc85349ad5b26c52137a79fa3fe5c29ab5cd7615013219c1941b6708e9c3c23feff5febaf0c8ebca5750b54e3e6e99a3e876b396f27860b7f3ec4e9191703c6332d944f6f69751167680c79c4f6b57f1cc8755d24b6ec158ccdbacdb23107a33cb6b332516c13274d1f9dccc21dced869e486",
            mda: .SHA2_256),
        testStruct(
            msg: "0000000000000000000000000000000000000000",
            sig: "8a1b220cb2ab415dc760eb7f5bb10335a3cca269d7dbbf7d0962ba79f9cf7b43a5fc09c99a1584f07403473d6c189a836897a5b6f8ea9fa22d601e6ba5f7411fe27c638b81b1a22363583a80fce8c7df3e40fb51bd0e60d0a6653f79f3bcb7ec3e9dc14cfb5b31ab1735bca692d50ac03f979dda92747c6430f8045efa3513ba6e0ce3e9e35570e1c30c8ebe589b44192e1344ca83dfa576fc6fdc7bf1cd7cee875b001c8c02ce8d602769e4bd9d241c4857182a0089a8b67644e73eef105c550efa47a40874289395ac0c4e02fd4ba98e130a4c2d1b95521c6af4a002ac3bdc6e52122ae4c08cc3da1c896e059acbddec574ac0432f6103dd97273d8803c102",
            mda: .SHA2_256),
        testStruct(
            msg: "54657374",
            sig: "264491e844c119f14e425c03282139a558dcdaeb82a4628173cd407fd319f9076eaebc0dd87a1c22e4d17839096886d58a9d5b7f7aeb63efec56c45ac7bead4203b6886e1faa90e028ec0ae094d46bf3f97efdd19045cfbc25a1abda2432639f9876405c0d68f8edbf047c12a454f7681d5d5a2b54bd3723d193dbad4338baad753264006e2d08931c4b8bb79aa1c9cad10eb6605f87c5831f6e2b08e002f9c6f21141f5841d92727dd3e1d99c36bc560da3c9067df99fcaf818941f72588be33032bad22caf6704223bb114d575b6d02d9d222b580005d930e8f40cce9f672eebb634a20177d84351627964b83f2053d736a84ab1a005f63bd5ba943de6205c",
            mda: .SHA2_256),
        testStruct(
            msg: "61",
            sig: "38c042a00d6f27742a46f1f963a7b2e04f0eac637849631a491b8e4e58fc721c6ce620d5e705dc8e73409c3909c1c68b6bdb2b30f882cf2797e65030b38c4e7daf6fef9d1f115c890086cf54ca3e7c2b21dcbfd1250ed1d925810970f17dbf482d1784f296adee9ace6979075c1e12f5580cfb322e8737db9d127d38e1b99ed87ec49448a18a6fee650d3c27e4a2a86a3d6e3ce4fe64120be60872fa07a3f78a112715c167fb6c900698ba1afd824087a4cf733335c4a6d5120e3b29bc42f3b3d5db79973e4e321e0910a288d18cdba172d060283c4f4c6656e9175a18b756b7d06251e9060bbfcab04978853eec6032850a0e757bc0c61ad38aa4eb6bb6d907",
            mda: .SHA2_256),
        testStruct(
            msg: "e0e1e2e3e4e5e6e7e8e9eaebecedeeeff0f1f2f3f4f5f6f7f8f9fafbfcfdfeff",
            sig: "2ae8d95b19cbd64d0e343ff413fffb85d8e6713c06ac8a1ceba7f3924fa740f8d2b3e120fd71f22711e795cd6468c5e263b1a5ba6ac6b8fa9e23d2d6e7243f510592a61d134e68b8ead00612dbf38c5b7302abc3bf33f23e6d4816a6e3ddcea6482566e84f57464f7d56de4cef0b2256ef21874dda4c131a47292ff8ef853f93804483c8e6373d39ca3a22552e75427b812b861de6a310ff4c366f6f6604116efd9770170aa423554c4ebbd2b5c0698950e66bb5b7c5c346285d9f5c35146255736b6e818e8e77983c93b21e7f60b04a7a525598e7fd8049b181000bffc7f3753a504370f6bb70617ac8e914deb05a198a5758a459c9fcd2fce1aede48e8a852",
            mda: .SHA2_256),
        testStruct(
            msg: "0102030405060708090a0b0c0d0e0f101112131415161718191a1b1c1d1e1f202122232425262728292a2b2c2d2e2f303132333435363738393a3b3c3d3e3f404142434445464748494a4b4c4d4e4f505152535455565758595a5b5c5d5e5f606162636465666768696a6b6c6d6e6f707172737475767778797a7b7c7d7e7f808182838485868788898a8b8c8d8e8f909192939495969798999a9b9c9d9e9fa0a1a2a3a4a5a6a7a8a9aaabacadaeafb0b1b2b3b4b5b6b7b8b9babbbcbdbebfc0c1c2c3c4c5c6c7c8c9cacbcccdcecfd0d1d2d3d4d5d6d7d8d9dadbdcdddedfe0e1e2e3e4e5e6e7e8e9eaebecedeeeff0f1f2f3f4f5f6f7f8f9fafbfcfdfeff000102030405060708090a0b0c0d0e0f1011121314151617",
            sig: "7aad44a36610ac147835efc623e3aeec0d5d8acbd7f469f92142592c7b843c9326e2015c4bf3843678d2e183ec9ed568e5dd8d535ea77a6d7fe804222e6208d0160bd6cf2744cdb56bce0ed7269cc5f2bcc25d3474c0fb5bc7d20ebf3664bad858dc6e86dabfa5f39a70e23344ab4f8d5edc6397d9d1b54fda4216e0b93d37b906384f82d36666d526939e0f917344208aadf05416c656a11a307ce2101912763728cfc0bd237017d36b8566c6c366b13f142c93edde181146ec63e49a57335b5d9295b85aa4c00d49cae7930653a5651c21371a4b3ec8a6e0f371d005e8b4f1631f7466b767b4789e75e1d2bc63ce4c46e5e7baf0b801ef785fd07ae79bbeef",
            mda: .SHA2_256),
        testStruct(
            msg: "313233343030",
            sig: "8a0e82d4f334aca72a718b6f8f643f69c6048d619d5eba71263a5d2d3ac7a7af133b780c7595ca2c982c006e861948f543cd0210c758691f9626842c25de2843ea314ca8eff285d47e0cffa54180af416004017034962a80a5959c3d3f1bfc154a4824462a93c014f6dfe920824f414a6e30e0e5944d480b99949ec7bf64c4a7461575933b17d7d6b0178b5192392ace3ed8469e8ac1dacae51ad5d3ad73dcb213e056d04596e64d8c0703def3110c7cecc93ba8ac8059f0f3d66b89d8712c62b41d407e4b4a104f4569558b0290c213cad6d0653898b9df8f4a453ab07d13bfb7598d505abbd0c4987e4f1ac66e1a523e113e370ab7cf990f0cc63f50f4f0a4",
            mda: .SHA2_256,
            ok: false),
        testStruct(
            msg: "313233343030",
            sig: "8d9c25235cdcdcc7ca2558c0be14f83afeb303f00c13106ac5affc952af527a0585cf4801104a7d019fa2e63fd0b923c061a24b8be7c3105443c8eedf4a033d3de802adfd80f872d3c505f41e3feb116f5d5f31f04df3e448bc7e7cbc2343f7dd4f4c3d2670ed3d3c66f91d626bb12a2001160a123d03b77d2a6ec53445db517147171e3ba3cd7dde902c486c74e8d8d33d4f7699791179d1df4fac78cda67da9138c18f2cc8863018e1739fb309408c62051b715096512602c5c4c7e7c394282593ec087832fd48b4f353d8046600e4152c2092632a79bf05497a13840e171047d79c23a76896235e9d5f0f56a78d3fe472fded2899e228f714690b40b66ee7",
            mda: .SHA2_256,
            ok: false),
    ]
    
    func test2048() throws {
        let pubKey = try RSAPublicKey(pem: pubPem2048, format: .PKCS8)
        let privKey = try RSAPrivateKey(pem: privPem2048, format: .X509)
        for t in tests2048 {
            let msg = Utilities.hex2bytes(t.msg)
            let sig = Utilities.hex2bytes(t.sig)
            XCTAssertEqual(t.ok, pubKey.verifyPKCS1(signature: sig, message: msg, mda: t.mda))
            if t.ok {
                let sig1 = try privKey.signPKCS1(message: msg, mda: t.mda)
                XCTAssertEqual(sig, sig1)
            }
        }
    }

    let privPem3072 =
"""
-----BEGIN RSA PRIVATE KEY-----
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
-----END RSA PRIVATE KEY-----
"""

    let pubPem3072 =
"""
-----BEGIN PUBLIC KEY-----
MIIBojANBgkqhkiG9w0BAQEFAAOCAY8AMIIBigKCAYEAxv4jeSVmAjwmUofFrG9x
VBwJlNEdBZ7mQDmG76IcJLUb2R2IYvnfeaTjKOPifIPfJgslqbQ0IK/8RLUejXUl
tvKcNypAUQRzIAdSemLtgvrHP0iSqA4JaCpBpYzTRwF/O+fYATNPktkyGq/VO1G/
+r/HUs/Mrgse4Dva/55CjMHBF/GslrT+I/jCPmOBGGpm/VkokzmuVcS82tv/hKva
pTIkDU4dKLLQSB2t07JGVXyo/hgJKBdzCznm7jeP/MhbGf/ckWqbmRprZtSpx7q1
9eejciEBFC56QQjBXVc7FSieB+RurqB7QsKry6Mw6ZVUtGVhZbtMDbK2OToH7KV1
xRqTxOFb2w90eQlEfj7+NMZ8qJVLUw5WogobbYTUXtG806pY7AbxhO5YV6qoGeHM
qaJvTijWuXfTORbbmJbSUtGvp2Lih8sNOEzHW/5T9Oki0C3QpIHAQuLTBrSzwYk3
HldbJeAAWhZM9p3Ql25NW+R2gG6mvmCE5xq09axcGxIDAgMBAAE=
-----END PUBLIC KEY-----
"""

    let tests3072: [testStruct] = [
        testStruct(
            msg: "",
            sig: "157ffb942b1363b5989ec4beb93fb0187ef016de4ce055620825d13c3dafd4fff621c71920e884ba28c5e98b328baac29ad4bfc4d2cae2f0ecb9d1b6c9fbdfc385aa565aaf6c5b3150e085e0316e21d7d440a873074e5d2700d961114ed420478647a4769d832691f7a004d934a89dc249c9343341902d5d0c3d1a623001265634216beacd5f756821f21c3b58111790657690918a2eafa9e85ab1ee44edd3d8bb89e892acf411ba9eaaeef88eca37dffbda72751c117364fd1b38c840d7b42318fcd011a4449aeffc2de32836d3a4f704d4c8ad4e078315d0d1758f098f2ea749ccce62aac592ac4041b5e733ba0431b88332a39a2af7f68f9bb1f469a793b280b964f285ce5cd1ff3adcd7dbd464a7c9414ed45791073f08415be2dd9f01dc2fec8c3a26fe97d9778e2b2fccf71a1ea5e9ce017d2d46778d7e37bb832ebd5825b3257a7852db5cb6c132bcf9ba3522a670b0e866585444ed3601fd32a922818ef6611626eee3ea99cfcfeeaa4c370567cc65e0479bd35e091b772d7445cade",
            mda: .SHA2_256),
        testStruct(
            msg: "0000000000000000000000000000000000000000",
            sig: "631cb4bed6b79dcd3827879f6d64de3ae17e0fdb022be013e733bbfe0031cf204f0508ab87a2e2bbdfaa16cf24acc96b3fd2e72bc4a224428e515d6f1e0ea6927eba6ed7282a959e5df5e52eb3be9a39cfe139ea2fa45c21eb81b3197eff655b918f7c5fff6abab33945557a922063f9600a372ae7701db686f7e1fe4a6e804a0f624331fbb59536733bed3710dcacd22ec74b1a1386d045372853cac91130703ecafad7f6f42ec1aade5cb865339743c83e882f248b0db0855f487a6d3b55442f67773611a11813ff46a58c762b1bd70b5e870c3095507f23758e90b3c84526f47a825f0ae787acfd3ed349ca6786a2e84ec500c6042a9027a994c328c7a6868e6a81481b294383edda62773fd224af46e782ea3f00468515f6100486d94e818afca1bdb81851e62b3bf4f9236f061afafb3e399b93e6f6a295ae200c9bba5ff5aabcac8361c84f2e69aff8a8a21720b900d52ea4bddcfbaba3a231bb9b0dd48f0a4ef1cdd255b3524ca0633d04907ab672314c5e3173108313ff4a97df3772",
            mda: .SHA2_256),
        testStruct(
            msg: "54657374",
            sig: "5819a699691c01a7f35f0bb1831a1cb65631ef693f7c9ef89f1e8460ee2ec312f6fd38fe382b3bf4db8f5d208146c32c5ed2d3b13105743767a73529bfddb5753c8cc13148d41db97f69ea1dee0ef1e1de990ff565f633bd3cfd315a7dafc70aa7f27d4f6486a2f1e2711e7919c5c73c518069338c0ac984d75f58b00fb0eee0f7da6c9c84d97955137417df8f20c02b7893b5cd929ba37f6b3278a1bd35748e14086c5f7100abf2edebeab5f767bb83d999a61cc27531bb67e44a92004fba9944b9c5f770bc66671d2efc74e01fbbd2885c5175a1fd72b91937c324b8d99d3592bfb73efb9641b87949266de441b61d180e141de510ae0cdefc2160df918c08c53799f050ca4eeb3a8b6b5ed35b8b59d3acd13a600a8a137eb1b8c1abbf55f3e99cf52d7092d1e3acc08583b04aa25a052668bc982abf060ffb17c1782daf76fbd69e7fc9510c5c6a68bd525719be5b81d0f2a8b961f1aeac7dc13aeeeef9986c7a47b34f8b96167d79f7ec458fef7345c1c31bba599d09b3fe33e738bc7da1",
            mda: .SHA2_256),
        testStruct(
            msg: "61",
            sig: "9858e2557c6b99fbd84bc7eac3e31283a4efb351ff019343760a1e282368938e29ad902d3eb6cb29b35a036dfbcc7e06d2f1d15548df59ced35326295375bacd7a9d28a01b4e8acfb676d80b6295e19c6b7a259df56456e1df72f6a746e9cd31fed9b79b35d7a30a7aa257e9e8ac60ea886042b9194e7a383d1c9f71c84511faf6c96f7ae0e690112b26bb60cf7bb10f684e4fbe2a3a1b1c0caa9b1bdc79fde23fb758c2ba57880a4de461ecd2bc696689438183e2b9724fa68258f461bb4405425620a4d95c87ddd83e04be381bc743b05d26ede2ceff8a858636baadf56ef1dab54080da0f516307c579833717def053c8906d4f102448ab22693e7f52d5850193a40ccf0d68d1303953771a73924e4bcddd8486e1477d96250bf6b480a5f4b822822183694c52a2edacb331564444f0335d3b17d511ece59889b6d961767a3192d7f081caf7e671addb3757451776d4bd3b03f7b689843dcd59019ae4f292dba54738a88b86cc6ce3b123c61a446f4878b627a7f3585d8ab7bca9b258f10b",
            mda: .SHA2_256),
        testStruct(
            msg: "e0e1e2e3e4e5e6e7e8e9eaebecedeeeff0f1f2f3f4f5f6f7f8f9fafbfcfdfeff",
            sig: "1294490626bdb36a31c93fa7853d93152d920b022f1b473bde3083a99e11aeba8c03218fa07d6c4a5f8b2504d2cb54505c40130fef5a2412f7a5ddfec5e2c8b5058f7cbde7ace0ac01c7ba8a1bd897e8974d991ad2b95c2f03100a34ff408a788c70ab5ec73b5356a4e3c7beb44fcb9e2f3f25d1c974ed962b148167684351dc2a223a174c9744b092071d58dfd39c38364f47d292651e7806ad7962bbedb64739d7ea298f0254244790e3971c15b861c95f00f65532aa1c77fba5c04ad078525128e92ed2b4f1269ae744547e3efd4ebb63e9df844df152a098c47fa492bfe0f1917ec973867c7491f64c172cf3ea1bc3f97b42a397e6ad88d12e150d3dbe360071a3285d6a68ee6e736eb4d7d637c649c2f545259ecd430b25b38a1618d69a4602ca8a2a151066f12c3807f5dc7cbd06bf095711e4483cb0a89c26dd9e4b0b03e05beca349f601c894f9a245aca3204584a9bd844772dd87b83d481c8df18b615307eaf643cbe856488c160e077458e899755301749d2d27bc190d68a5da11",
            mda: .SHA2_256),
        testStruct(
            msg: "0102030405060708090a0b0c0d0e0f101112131415161718191a1b1c1d1e1f202122232425262728292a2b2c2d2e2f303132333435363738393a3b3c3d3e3f404142434445464748494a4b4c4d4e4f505152535455565758595a5b5c5d5e5f606162636465666768696a6b6c6d6e6f707172737475767778797a7b7c7d7e7f808182838485868788898a8b8c8d8e8f909192939495969798999a9b9c9d9e9fa0a1a2a3a4a5a6a7a8a9aaabacadaeafb0b1b2b3b4b5b6b7b8b9babbbcbdbebfc0c1c2c3c4c5c6c7c8c9cacbcccdcecfd0d1d2d3d4d5d6d7d8d9dadbdcdddedfe0e1e2e3e4e5e6e7e8e9eaebecedeeeff0f1f2f3f4f5f6f7f8f9fafbfcfdfeff000102030405060708090a0b0c0d0e0f1011121314151617",
            sig: "6533f9ec83cda0ca8e3c06c440cbfcd4e5d98b07ecc2419714513b454ec710c04d1ed50808db5131c69f091a5a088a6d9c93310ba7a9616a0b45fadfcba655290624bb529a86ac215f6c76c89030c82ebb8b0eebebcd2a398978185f47284cfe119b2b6a5ecf4ec1a63663c351e422599004481207bc7c15aeb1ef30248b3c2935c7ad0b2205a2f62b7baac72f33ac0b8e9f5d146a269791d901310f64318cc66dd4283008214b6012ddcb1e7450763b9bf236a4d282a62f91cd011af439278c2812e4de55f6480bf6b31e60fa57d7f40d9fd56cb9339f2664d95fc372e204a0271014d041d2856bc29a536cb8ea5d33fad437b7dd4bc1e8244e10c08e1887646ef322b57d77c4be94031811169cde14376e91f17bd71903ccbfe320921732e69260756718b54d1aa047e189437a1d0bf9edf8019b8ed4b173aba3448e7309a443443bdae326a9c98d9a66c271e53b8353d0340b4cdeaa319b0aa45dc21f0e8df6117b80d7d6a5cabbce40f72edeec42ccb5106c1afbed518f3d8b7117acfde4",
            mda: .SHA2_256),
    ]
    
    func test3072() throws {
        let pubKey = try RSAPublicKey(pem: pubPem3072, format: .PKCS8)
        let privKey = try RSAPrivateKey(pem: privPem3072, format: .X509)
        for t in tests3072 {
            let msg = Utilities.hex2bytes(t.msg)
            let sig = Utilities.hex2bytes(t.sig)
            XCTAssertEqual(t.ok, pubKey.verifyPKCS1(signature: sig, message: msg, mda: t.mda))
            if t.ok {
                let sig1 = try privKey.signPKCS1(message: msg, mda: t.mda)
                XCTAssertEqual(sig, sig1)
            }
        }
    }

    let privPem4096 =
"""
-----BEGIN RSA PRIVATE KEY-----
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
-----END RSA PRIVATE KEY-----
"""

    let pubPem4096 =
"""
-----BEGIN PUBLIC KEY-----
MIICIjANBgkqhkiG9w0BAQEFAAOCAg8AMIICCgKCAgEAlWNT7LdWGUXcVUTkYCRm
B4yT8oUHcB/9OeKpgTyKyHQOatYclV1ITlE7Pc6lJ+ABoBjuLCB8GAapZ2MoAjbN
PIIN/3mDfJtwnLS1ItPdvJGSJCJZxDvnXqJE03zPqKTHUCSiz3zHboQuppzHyhIn
QFsHAEc4elBo5JduS47V+arde02wJPu4172KBA2PZhDBxusdS2Bt/RgiNdA2CIAw
TVp1BgOvDEJLjI5tvBLDaX0tYJyXVH53Ti42LqltFpDclDIRLFNSWLPbLEwyrVEN
bAetB4g1eIOGnvuLYpKYckhHklz0KzQ4a+cA8CkD21hSJ2vuI3CUHzl73DkF4wlk
oLXnNgJwM0CWDD7WB4JjthHxl5Vf7M5LmjLkPNHS5eh8TOtl7ciFOn7jHSjhblrf
+4rHt2D7/GPV8XT00JNkYduxLJZKa21s7nUuX8oatKn9I43T6IYKHXY9IBn557me
12ZtTgOHEPkOAJO8VmmH1sAJL1cTducFs0LQZsVObiV4knuSwfCSjeROmm4fSbkH
xqpPYF7Jw5jVXfgcZzc7A8yBEBYvtBf5b9MhBIZH38uzkkVRFc2RLqgzUYU+ahhS
hGSIQq3L0l5nF0o7k7imTOLOneDoV3uLZizjLiVleCZl3Tjlu1/MT+EuQyDat3c7
VFoJxtOdnbrUWfIfPmJO5u0CAwEAAQ==
-----END PUBLIC KEY-----
"""

    let tests4096: [testStruct] = [
        testStruct(
            msg: "",
            sig: "368105195f0dc82c2cd37e8edc6ddc0c983dc13ddcf6f9db9a24b52921e5280319a1bcf797f774066d643e5c99b811f0ad9df2a3f430f4848a03ddb97e06daa4d01ddd50bf2b638935cd26b19d6ffccba884a4e7cba35830c6cc5ccce38bc0fcc4ea421347e241711a551c67923b3daaf2e9c51635d416cc2393a9a4f108f84f26990c11dbaacea75e39dc6082b539cd2c0c8dda6c78cbad12e14a352b9dd5c92a3702d8538fcce0e92e26489ea83d75c174ab671210fbc6c397be2167864b519b5136d23a4363ef773ebc140e1da4b0a788d7b1f15a300375ee42b27261675fdfc60c29bab7022dc2e624c7d1f31e278ac089c5880e701bec41f63c8f897c0cecc5eff0a801dbc58d7d4df6e860c20e61f31d9ab2d50e8fbec7471070d8ed06c4c9c725cb63afde0cc4475d3dcb7dcad7eabd874ddf7294cd9d2a66b13b6367a14dfe3827da0c6c8b9e734deece80fd79609ce5ce0a16de6610fd04a09b0b2411bae2bc3222ab4c02867838d0c8346c60589e6204b226efb401841fb95da05ff32989ef935425b943d1b5d2f8af5113491a36c60a98c90b6453144f5fe00a0df3de8d02f0f59c7b94ddc7c8895b1dff8d88f69a9a2cfbb55eda0837800950601fc9e230a5514c9674fb576df8391c51ba0febc29c267462ed5337326b6f40d243ad7d81459ecabbd00126b2142e6ba10d9f903a9918d2280c63ee84b47062e1",
            mda: .SHA2_256),
        testStruct(
            msg: "0000000000000000000000000000000000000000",
            sig: "46a6c9cd78e38d5567795dbea71872ac16da06725975cee7d8839d2de665ec3b8411277f3e026fd2f9b836d788b48539755858bc8be0804147b59c09354b372713145e5a000ac15744ccd2db5795727e2f4d5f67bcab5e7cb1290824963ae88528aba0e6785989c8adb86084d26dd1faea3ae2a6175739fe978b576eff673832e513419806d206e0984d1ef0e1c8d8981084ee2ee569806b003fb7f08e775998eba1771f1efa070c00a769363c6101d5c5fc6140f102469574cd09746130ed80d14eabcd0a0418a752d5595b5f40ee0fb05f5f9860e600d75fbdd53461f5ea18be5bd807281f9e8fd6cf7eb31985206c9a5033cdea631512bffdd977fee5e692b3153a2ce9c7708a9c7d665d84762740cc9ea374bd32c18c2d76320e4893a2fac374ca7122e01e08011c351bd33725a6adad96becd44e4ec1032fbfb0c8dcf13cae9556eaf419211d0149c574b8d12ffe5bc59468c7c549283be541697258af847e52a9aa8063557dfa40404adbaa95e38ad28eba053aec3c123e98ab1b947bb774841e9040dd5409068a2c8a84c530fc4273897ed845d76dbafbf45af1a8fd2767234fac1e852453d8b7eede02af228d8b5821238a50a321490dab74d687a3400c34f215b85823424c9d966b516cccac38fc7f08769f47d66c57b9b75ea67be82508a513946bcbc809436efc4ee85f139b143c5bc15ff69ad1f3667c3f69bcf",
            mda: .SHA2_256),
        testStruct(
            msg: "54657374",
            sig: "43929c2fb0986fc4570a3ee7f6701b96a78ec9297a997415a142ae539031c0e196add5e4c6ec572de0a2b109cf23a42567ebe98f42cf312d07538e4a32b0f20403b662c652ba9e3d6e38a625d6b5e91cce5c810d7a02262338e144a57db4ac4debfc536e8eaca7fe08022a2f64741d66d25e3010f2fd259d4c6b00582584bbbdcde4266d86eddfd0443ff24b06cf7ade6d733c637a48a398dbb28355ffb9bd21a49de6b345ef635b68d917b5bfcb9016f7c64c444dc0036ecab8f59b0d29098facca02335df44db87d30d02f08553ffd0379b33d13d09a385cae7d63b6db52e9b1eb8fd549e0e1e18210de1d3e9527547e5c72f816eb36288b09d96db772f955ca46fc8cbdb6eea93c841e1075c00c3c45e9442d28095136cc5ce8212ed8c60c9668898ab5d64734d4d0f2311f104cf8a732e6d88fb2064cb57bd54d3cdef7c11c840ecb238466c747289233a317b73785778ff4349949da47c9b4b2dc9f89bd1fe7e98b582500dfc05dba3fa410cca66acd854669940543c22ed1038eac7f0212b9ce4aedba0eb15ea1e75a73c45c1ae03fd241662e9cb89b051939c468db3a0adab822617b5bc669d1e0226cf6b475445d9d5e77ef54ed646cd81f0952b949b7f4f37381ba6427e060966467a76e1d9261a5fe8c68398a89eb5025cc39339885b6c33dde898a159f0af4acc81461fae37f5f4c61de4a888dc4f6b1e2b7336f",
            mda: .SHA2_256),
        testStruct(
            msg: "61",
            sig: "374603f5d4728526e6cc7c7bfb6f456bd33bdabf37d942dfa8132a9479f6e4a9c2dfee515d883ace45cf1d660190e442a9ea7590d67aac9bde6951314af90baac21bed537c774148afb7927337d626525e13fa15664cdd78dfa5e3886ee1fe7137ad5f69aadcb098a0d49475b0f76ed1bb86cbd08a0cae9a6ec120eabd55b7e5c4456bfac2b2acc3892110b7f62c0dbe7ec7e491474c5c641453743fd70b15f7a726a0ca44a78bfaf3445a979bd4df362b7f29d4ed9189bfcdee01476cf1b48c2edaf02d226b41f587a8db161bd36e6ea20d64c8773fbe8c0296b9e016ccde333b380161a641d822bc65d3b60417534072263cd461a4f77826cbd0508ea11720081c34b12d80ef0963857624d48c53748f279bf6ad338ba564e35d37d1dea27d19ad5dcb76d6f4aac62e49eededb1121e06b9f78eb285f7d7ee2cd475e791cc04c029cb76e5b33743aca3ac3adf5e317d95aa79a2f0ac3c328e69ea4692661b8107d89eeaaf3be01122544fd9d0c61511e87c6a5507c5701655d35f71586badd55b26363b51f019896c03326c72332de5be8a0f146d630a6e747a906684c7dc59d3bda667c8a92432e879f6a4d91d3cdca89b9840285bd8a22e5e5bebc32011725f64cb5fcbade8a5f5f9ba372a9be7f0a4907e40b4d06feffee3a558fd023514b504308a1d821c41955c305f550ffdf005b9bd5dfce2d16d3d09bf17c156c4a",
            mda: .SHA2_256),
        testStruct(
            msg: "e0e1e2e3e4e5e6e7e8e9eaebecedeeeff0f1f2f3f4f5f6f7f8f9fafbfcfdfeff",
            sig: "401bf4e63be4259b54c5909797b2b01fca18a6f74d76fecf75535f2876079ad9ee56c653dafc3513eb02114f5c96efb4025cf58c2cd576d003f688b11458fe3df1657657ed52b2756a99b48c6722708ef11765c8da2f3b061c779f26a64fe13e4be4602d0ca2553793d36c23f3194705e34a75b9b91ff7f4e554c5907b85ecb561a8d22262aa3669cc7be2fc5c21b9170869ff52dcba46b2b1c688e4c04e7a8f099e3a4196863bd1e828fb5ea5443b64b190327622055d44ff4c9999601338e56c175c716abf8d6c2ce6b9ef17930e846745e751f882ffb3f0b1a20e68ce9083d1466295caacdce85bd4a34615d09f2051839ff83650708888db818aca9229c38ddef86848a2c0c88b86a2f5a1079dcf0e888be62e116850b7e8d06785627fca1899f6d7c02eb60c3bae0d538cde8a05ef7281bba7f35757360ffa79fdd08642b6af5aaf8c71a32aecd0e9f3d9a2ef164da1740a5c2dd7943603bafde05e38f2ba78c15c3eef13a5059f3f242f07af2e6044896d1d6d9810ed3fb8203ca4efc116e95d2f53be8c55fc1ce653f02597c0df7d4a7dd88b41c2a65e40bf5dafbef2a97e4dc3bb49445774cac283ae131c08492c9715712f998241e16eb776915f15b7e9544ccf1dc220a9e139defd63cb2951090808395ce56555a7cdab4564d82151ddc0ba00db24454f2174bf0fe7ffe6e2d9d82a92437890bcae1601dbcea29a",
            mda: .SHA2_256),
        testStruct(
            msg: "0102030405060708090a0b0c0d0e0f101112131415161718191a1b1c1d1e1f202122232425262728292a2b2c2d2e2f303132333435363738393a3b3c3d3e3f404142434445464748494a4b4c4d4e4f505152535455565758595a5b5c5d5e5f606162636465666768696a6b6c6d6e6f707172737475767778797a7b7c7d7e7f808182838485868788898a8b8c8d8e8f909192939495969798999a9b9c9d9e9fa0a1a2a3a4a5a6a7a8a9aaabacadaeafb0b1b2b3b4b5b6b7b8b9babbbcbdbebfc0c1c2c3c4c5c6c7c8c9cacbcccdcecfd0d1d2d3d4d5d6d7d8d9dadbdcdddedfe0e1e2e3e4e5e6e7e8e9eaebecedeeeff0f1f2f3f4f5f6f7f8f9fafbfcfdfeff000102030405060708090a0b0c0d0e0f1011121314151617",
            sig: "3b24aa8966f2e4b1e3b08b60479b69d415d679ad786e527c41c5059ef17b4df55951f3e7fa55f46c3b88888437747c9a90c26581461958fded191cd881adabb7afb8f9f195181408dc3332c916bdb1f4655eb17e9e481a2c647e56df365605908402739056f0df65e09b6d9594e0a57172c91be078f306f59d3d861a1abd9374a5ece07f86659ac9e40d5d4d8f73105464b3b86f45ccff1a4b30e7a7fe829e22bbe4e9e3d2b53c5969a3fe364a4caa0e69c5b0135cb5ba73a87d804f6a475b95f255a0a8c7f0c81c98ada1c72403b691b8853dee397337cffb707eb962ecc9e8af2f21cc014167fd56854b61f82bf32097182f4d36cf34c28b2303d9715046618c9dc2adf759ec8ac5829a8ca162c98e0fcc18bafb98965f655950e66d9e0083a1e1c452a4ee89d6b34b3fdb54bc8da0be3210d888640fa1ee86cbb04158b6b6100f41ac8ec671566779cb99f26dd1992a5a7dbdae7e61d85abe48a52d32b4c4acd452cd58c842c71de44ef94b3d19c53e1db1a0041f199409bf11b27a6ad0830aa18097e8c5d25d42fc2e4826649ce7603ca8321ef56cdd7aa64e5938b18eeb2f468aefc73b33ec333ec8c889b8378b83fc717ad28702ff5116c23f7e7bf18d1e4781a4f7b7fe803f382b50ea02b8c60321318abdb48d04432c924ba852e269f61eda1fd39baca88bc3c89621b60e03d82f41647ef4a78c9fe1976cfeee8ec3",
            mda: .SHA2_256),
    ]
    
    func test4096() throws {
        let pubKey = try RSAPublicKey(pem: pubPem4096, format: .PKCS8)
        let privKey = try RSAPrivateKey(pem: privPem4096, format: .X509)
        for t in tests4096 {
            let msg = Utilities.hex2bytes(t.msg)
            let sig = Utilities.hex2bytes(t.sig)
            XCTAssertEqual(t.ok, pubKey.verifyPKCS1(signature: sig, message: msg, mda: t.mda))
            if t.ok {
                let sig1 = try privKey.signPKCS1(message: msg, mda: t.mda)
                XCTAssertEqual(sig, sig1)
            }
        }
    }

}
